# 1. RCC相关术语

- [1. RCC相关术语](#1-rcc相关术语)
  - [1.1. 时钟](#11-时钟)
  - [1.2. HSI振荡器时钟](#12-hsi振荡器时钟)
  - [1.3. HSE振荡器时钟](#13-hse振荡器时钟)
  - [1.4. 时钟倍频](#14-时钟倍频)
  - [1.5. PLL时钟 (Phase-Locked Loop)](#15-pll时钟-phase-locked-loop)
  - [1.6. SCB (System Control Block)](#16-scb-system-control-block)
  - [1.7. 预取指（Instruction Prefetch）](#17-预取指instruction-prefetch)

## 1.1. 时钟

> 嵌入式时钟的概念与嵌入式系统的工作原理和任务执行紧密相关。以下是嵌入式时钟的基本概念：
>
> 1. **时钟源**：几乎所有的嵌入式硬件都有一个或多个时钟源，如晶体振荡器、内部振荡器、PLL（相位锁定环）等。这些时钟源为系统提供一个定时基准，使得处理器和其他外设可以在固定的频率下运行。
>
> 2. **时钟频率**：通常以赫兹（Hz）为单位，表示时钟每秒的脉冲数。例如，一个8 MHz的时钟源每秒提供800万次脉冲。
>
> 3. **时钟树**：在许多现代嵌入式系统中，不是所有的组件和外设都在同一时钟频率下运行。主处理器可能运行在一个频率，而某些外设可能运行在较低的频率。时钟树定义了如何从主时钟源分配和派生出这些不同的频率。
>
> 4. **时钟门控**：为了节省能量和优化性能，许多嵌入式系统允许对特定外设的时钟供应进行动态开关，这称为时钟门控。例如，如果一个外设不再需要，其时钟可以被禁用以节省功耗。
>
> 5. **系统时钟**：通常指为CPU核心提供时钟的主时钟源。
>
> 6. **外设时钟**：特定外设或模块的时钟，可能与系统时钟相同，也可能不同。
>
> 7. **RTC（实时时钟）**：一个低功耗的时钟，常用于保持当前日期和时间，即使在系统其他部分被关闭或处于低功耗模式时也能持续运行。
>
> 8. **定时器/计数器**：这是嵌入式系统中常用的组件，它根据特定的时钟源进行计数，并在达到预定值时生成中断或执行某些动作。
>
> 总的来说，时钟在嵌入式系统中起到了核心作用。它不仅为系统提供了计时基准，还在功耗管理、任务调度和性能优化中起到关键作用。

## 1.2. HSI振荡器时钟

> HSI: High-Speed Internal。这是指的内部高速振荡器。HSI 指的是微控制器内部的一个振荡器，它不需要外部组件就可以工作，因此它通常用于启动过程或作为低功耗时钟源。其频率通常是固定的，例如 STM32F103 的 HSI 频率是 8 MHz。

## 1.3. HSE振荡器时钟

> HSE: High-Speed External。这是指的外部高速振荡器。HSE 是微控制器外部的一个振荡器，需要连接到外部的晶体或者陶瓷振荡器。其频率可以根据连接的外部组件而变化。外部振荡器提供了更高的准确性，通常用于需要高准确性时钟的应用，例如 USB 通信或高精度的时间测量。

## 1.4. 时钟倍频

> 时钟倍频通常涉及到一个被称为PLL（相位锁定环）的电子电路。PLL 允许我们从一个给定的时钟源产生一个更高或更低的时钟频率。当我们说“时钟倍频”，我们通常是指使用 PLL 将一个基础时钟频率增加到其原始频率的整数倍。
>
> 例如：
> 假设您有一个8 MHz的时钟源（这可以是一个晶体振荡器或其他形式的时钟生成器）。如果您希望产生一个32 MHz的时钟，您需要进行4倍的“时钟倍频”。在这种情况下，您会设置PLL使其将8 MHz的输入时钟提高到32 MHz。
>
> 这在很多现代微控制器中是常见的，例如 STM32 系列。这些微控制器可能有一个相对较低的内部或外部时钟源（例如8 MHz的HSI或HSE），但是使用PLL，它们可以生成运行速度非常快的时钟（例如72 MHz或更高）。
>
> 时钟倍频技术允许硬件设计者使用低频、低成本的晶体振荡器作为基础时钟源，然后通过倍频来满足系统对更高时钟频率的需求。

## 1.5. PLL时钟 (Phase-Locked Loop)

> **PLL** 是 **Phase-Locked Loop**（相位锁定环）的缩写。
>
> PLL 是一种电子电路，用于产生一个输出信号，其相位与输入信号的相位相关。基本上，PLL 允许我们从一个给定的时钟源产生一个更高或更低的时钟频率。
>
> 以下是 PLL 的基本工作原理：
>
> 1. **参考分频器**：首先，来自时钟源的输入时钟信号经过一个分频器。
> 2. **相位比较器**：相位比较器比较分频后的输入时钟与反馈时钟的相位。
> 3. **滤波器**：基于相位比较器的输出，滤波器产生一个控制电压。
> 4. **压控振荡器（VCO）**：此控制电压被送到一个压控振荡器，它产生输出时钟。
> 5. **反馈分频器**：输出时钟通过一个反馈分频器并返回到相位比较器。
>
> 通过这个循环，PLL 能够“锁定”到一个给定的输入时钟，并生成一个频率不同（通常是高于或低于）的输出时钟。
>
> 在微控制器和其他数字系统中，PLL 经常被用来产生高于其基础时钟源的时钟速度。例如，如果您有一个8 MHz的晶体振荡器，使用PLL，您可能能够产生32 MHz、48 MHz、72 MHz甚至更高的时钟频率，这取决于特定微控制器的能力和配置。

## 1.6. SCB (System Control Block)

> 在嵌入式领域，特别是针对ARM Cortex-M系列微控制器，**SCB** 代表 **System Control Block**。
>
> SCB 是 ARM Cortex-M 核的一部分，它提供了系统实现功能，包括：
>
> 1. **异常和中断控制**：这包括优先级、向量表偏移、异常入口和出口状态保存等。
> 2. **系统控制和配置**：这包括系统和总线时钟、休眠模式、系统复位等。
> 3. **配置和控制Cortex-M功能**：如浮点单元（FPU）。
> 4. **系统状态**：这包括 CPUID、版本号和其他实施细节。
>
> SCB 通过特定的内存映射寄存器来进行访问和配置。在许多嵌入式软件开发环境中，已经提供了库和相关的数据结构来简化访问这些寄存器的过程。
>
> 总之，SCB 是 ARM Cortex-M 核的关键组件，它提供了处理中断、异常和系统配置的功能。

## 1.7. 预取指（Instruction Prefetch）

> 预取指（Instruction Prefetch）是一种用于提高处理器性能的技术。在该技术中，处理器预先从内存中获取下一条或多条指令，以便在执行当前指令时，下一条指令已经在处理器近处（例如：指令缓存或预取指队列）等待执行。这减少了由于等待从主内存获取指令而造成的延迟。
>
> 以下是预取指的一些关键点：
>
> 1. **指令缓存**：为了支持预取指，许多处理器都有一个指令缓存，它存储最近使用的指令。当处理器需要执行指令时，它首先检查这个缓存。如果需要的指令已经在缓存中（这称为“缓存命中”），处理器可以立即获取和执行它，而不必从主内存中取回。
>
> 2. **预测执行**：预取指通常与另一种技术——分支预测结合使用。当处理器遇到一个条件跳转指令（例如：if语句）时，它尝试预测下一条执行的指令是什么，然后预先获取这条指令。这样，当真正到达这个跳转决策时，所需的指令已经准备好了。
>
> 3. **预取指的优势**：预取指技术的主要优势是减少了因等待从内存中获取指令而造成的处理器空闲时间，从而提高了处理器的效率和性能。
>
> 4. **可能的缺点**：预取指可能导致不必要的内存访问，特别是当分支预测失败时。这可能会增加能耗，并可能导致其他更重要的数据被从缓存中驱逐出去。
>
> 总之，预取指是现代处理器中用于优化性能的许多技术之一，通过预先获取指令，它旨在使处理器更有效地执行指令流。
